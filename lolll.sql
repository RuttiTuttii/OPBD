-- 5.1 Вставка новой записи в таблицу Книги (указываем только обязательные столбцы)
INSERT INTO Книги (Название, Цена, ID_автора, Год_выпуска) 
VALUES ('Новая книга', 500, 15, 2023);
-- Пояснение: предполагается, что столбцы с автоинкрементом (ID_книги) и DEFAULT-значениями не указаны

-- 5.2 Удаление заказчиков без телефона
DELETE FROM Заказчики 
WHERE Телефон IS NULL;

-- 5.3 Обновление цены книг со словом "Сказки" в названии
UPDATE Книги 
SET Цена = Цена - 100 
WHERE Название LIKE '%Сказки%';

-- 5.4 Создание таблицы Prose с книгами жанра "проза"
SELECT 
    Авторы.Фамилия, 
    Авторы.Имя, 
    Книги.Название AS Наименование_книги,
    Книги.Цена,
    Книги.Год_выпуска
INTO Prose 
FROM Книги
JOIN Авторы ON Книги.ID_автора = Авторы.ID_автора
JOIN Жанры ON Книги.ID_жанра = Жанры.ID_жанра
WHERE Жанры.Название = 'проза';

-- 5.5 Удаление пустых заказов через подзапрос
DELETE FROM Заказы 
WHERE ID_заказа NOT IN (
    SELECT DISTINCT ID_заказа 
    FROM Состав_заказа  -- Таблица связи "заказ-книги"
);

-- 5.6 Обновление цен книг российских авторов
UPDATE Книги 
SET Цена = Цена + 100
FROM Книги
JOIN Авторы ON Книги.ID_автора = Авторы.ID_автора
WHERE Авторы.Страна = 'Россия';

-- 5.7 Комплексное обновление цен по жанрам через CASE
UPDATE Книги 
SET Цена = 
    CASE 
        WHEN ID_жанра = (SELECT ID_жанра FROM Жанры WHERE Название = 'Поэзия') 
            THEN Цена * 0.9  -- Уменьшить на 10%
        WHEN ID_жанра = (SELECT ID_жанра FROM Жанры WHERE Название = 'Детектив') 
            THEN Цена + 100  -- Увеличить на 100 руб.
        ELSE Цена  -- Без изменений
    END;